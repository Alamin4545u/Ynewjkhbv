<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BSKF Admin – Premium Dashboard</title>

<!-- Fonts & UI -->
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<style>
body{
  font-family:'Hind Siliguri',sans-serif;
  background:#0f172a;
  color:#e5e7eb;
}
.glass{
  background:rgba(30,41,59,.65);
  backdrop-filter:blur(14px);
  border:1px solid rgba(255,255,255,.06);
  border-radius:1.5rem;
}
.btn{
  padding:.8rem 1.4rem;
  border-radius:1rem;
  font-weight:800;
  transition:.25s;
}
.btn-primary{
  background:linear-gradient(135deg,#10b981,#059669);
}
.btn-primary:hover{
  transform:translateY(-2px);
  box-shadow:0 15px 30px rgba(16,185,129,.35);
}
.sidebar-btn{
  display:flex;
  gap:.7rem;
  padding:.7rem 1rem;
  border-radius:1rem;
  font-weight:700;
  color:#94a3b8;
}
.sidebar-btn:hover{background:#ffffff10;color:#fff}
.tab-active{background:#10b981!important;color:white!important}
.section-hide{display:none}
</style>
</head>

<body class="min-h-screen flex">

<!-- ================= LOGIN ================= -->
<div id="login" class="fixed inset-0 bg-slate-950 flex items-center justify-center z-50">
  <form id="loginForm" class="glass p-10 w-full max-w-md space-y-4 text-center">
    <h2 class="text-2xl font-black italic">Admin Login</h2>
    <input id="phone" placeholder="মোবাইল নম্বর" class="w-full p-4 bg-slate-800 rounded-xl font-bold">
    <input id="pass" type="password" placeholder="পাসওয়ার্ড" class="w-full p-4 bg-slate-800 rounded-xl font-bold">
    <button class="btn btn-primary w-full">প্রবেশ করুন</button>
  </form>
</div>

<!-- ================= SIDEBAR ================= -->
<aside id="sidebar" class="hidden md:flex flex-col w-72 p-6 bg-slate-900 border-r border-slate-800">
  <h1 class="text-xl font-black mb-8 italic text-emerald-400">BSKF Admin</h1>
  <button class="sidebar-btn tab-active" id="btn-overview" onclick="tab('overview')">Dashboard</button>
  <button class="sidebar-btn" id="btn-pending" onclick="tab('pending')">Pending</button>
  <button class="sidebar-btn" id="btn-expenses" onclick="tab('expenses')">Expenses</button>
  <button class="sidebar-btn" id="btn-members" onclick="tab('members')">Members</button>
  <button class="sidebar-btn" id="btn-config" onclick="tab('config')">Settings</button>
  <button onclick="logout()" class="sidebar-btn text-red-400 mt-auto">Logout</button>
</aside>

<!-- ================= MAIN ================= -->
<main id="main" class="hidden flex-1 p-6 space-y-8 overflow-y-auto">

<!-- ===== OVERVIEW ===== -->
<section id="sec-overview" class="space-y-6">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="glass p-6"><p>মোট তহবিল</p><h2 id="fund" class="text-3xl font-black text-emerald-400">৳ ০</h2></div>
    <div class="glass p-6"><p>সদস্য</p><h2 id="members" class="text-3xl font-black">০</h2></div>
    <div class="glass p-6"><p>ব্যয়</p><h2 id="expense" class="text-3xl font-black text-red-400">৳ ০</h2></div>
  </div>
  <div class="glass p-6">
    <canvas id="fundChart" height="120"></canvas>
  </div>
</section>

<!-- ===== PENDING ===== -->
<section id="sec-pending" class="section-hide">
  <h3 class="text-xl font-black mb-4">Pending Payments</h3>
  <div id="pendingList" class="grid md:grid-cols-3 gap-4"></div>
</section>

<!-- ===== EXPENSES ===== -->
<section id="sec-expenses" class="section-hide space-y-4">
  <form id="expForm" class="glass p-6 grid md:grid-cols-3 gap-4">
    <input id="eDesc" placeholder="বিবরণ" class="p-4 bg-slate-800 rounded-xl">
    <input id="eAmt" type="number" placeholder="পরিমাণ" class="p-4 bg-slate-800 rounded-xl">
    <button class="btn btn-primary">Add Expense</button>
  </form>
  <div class="glass p-4">
    <table class="w-full text-sm"><tbody id="expenseTable"></tbody></table>
  </div>
</section>

<!-- ===== MEMBERS ===== -->
<section id="sec-members" class="section-hide">
  <div id="memberGrid" class="grid md:grid-cols-3 gap-4"></div>
</section>

<!-- ===== SETTINGS (PAYMENT NUMBERS) ===== -->
<section id="sec-config" class="section-hide max-w-md">
  <div class="glass p-6 space-y-4">
    <h3 class="text-lg font-black text-emerald-400">Payment Numbers</h3>
    <input id="bkash" placeholder="Bkash Number" class="w-full p-3 bg-slate-800 rounded-xl font-bold">
    <input id="nagad" placeholder="Nagad Number" class="w-full p-3 bg-slate-800 rounded-xl font-bold">
    <input id="rocket" placeholder="Rocket Number" class="w-full p-3 bg-slate-800 rounded-xl font-bold">
    <button onclick="saveNumbers()" class="btn btn-primary w-full">Save Numbers</button>
  </div>
</section>

</main>

<!-- ===== MOBILE BOTTOM NAV ===== -->
<nav class="md:hidden fixed bottom-0 inset-x-0 bg-slate-900 flex justify-around py-3 border-t border-slate-800 z-40">
  <button onclick="tab('overview')"><i data-lucide="layout-grid"></i></button>
  <button onclick="tab('pending')"><i data-lucide="hourglass"></i></button>
  <button onclick="tab('expenses')"><i data-lucide="receipt"></i></button>
  <button onclick="tab('members')"><i data-lucide="users"></i></button>
  <button onclick="tab('config')"><i data-lucide="settings"></i></button>
</nav>

<!-- ===== TOAST ===== -->
<div id="toastBox" class="fixed bottom-6 right-6 space-y-2 z-50"></div>

<script>
/* ================= FIREBASE CONFIG ================= */
firebase.initializeApp({
  apiKey:"AIzaSyDeFrZUu2ZwWzFa7owaC0v6WO_zP2lEJ1Q",
  authDomain:"firstdevloping.firebaseapp.com",
  projectId:"firstdevloping"
});
const db=firebase.firestore();
const auth=firebase.auth();
lucide.createIcons();

/* ================= TOAST ================= */
function toast(msg,type="ok"){
  const d=document.createElement("div");
  d.className=`glass px-6 py-3 font-bold ${type=="ok"?"text-emerald-400":"text-red-400"}`;
  d.innerText=msg;
  toastBox.appendChild(d);
  setTimeout(()=>d.remove(),2500);
}

/* ================= LOGIN ================= */
loginForm.onsubmit=e=>{
  e.preventDefault();
  auth.signInWithEmailAndPassword(phone.value+"@bskf.com",pass.value)
  .catch(()=>toast("ভুল তথ্য","err"));
};

auth.onAuthStateChanged(u=>{
  if(u){
    login.classList.add("hidden");
    sidebar.classList.remove("hidden");
    main.classList.remove("hidden");
    loadData();
  }else{
    login.classList.remove("hidden");
  }
});

/* ================= TAB ================= */
function tab(t){
  ["overview","pending","expenses","members","config"].forEach(x=>{
    document.getElementById("sec-"+x).classList.add("section-hide");
    document.getElementById("btn-"+x)?.classList.remove("tab-active");
  });
  document.getElementById("sec-"+t).classList.remove("section-hide");
  document.getElementById("btn-"+t)?.classList.add("tab-active");
}

/* ================= DATA ================= */
let chart;
function loadData(){

db.collection("stats").doc("summary").onSnapshot(d=>{
  if(d.exists){
    fund.innerText="৳ "+d.data().fund;
    members.innerText=d.data().members;
    expense.innerText="৳ "+(d.data().expenses||0);
  }
});

/* Pending */
db.collection("payments").where("status","==","pending").onSnapshot(s=>{
  pendingList.innerHTML="";
  s.forEach(doc=>{
    let p=doc.data();
    pendingList.innerHTML+=`
    <div class="glass p-4">
      <h4 class="font-black">${p.name}</h4>
      <p>৳ ${p.amount}</p>
      <button class="btn btn-primary w-full mt-2" onclick="approve('${doc.id}',${p.amount})">Approve</button>
    </div>`;
  });
});

/* Expenses */
db.collection("expenses").onSnapshot(s=>{
  expenseTable.innerHTML="";
  s.forEach(doc=>{
    let e=doc.data();
    expenseTable.innerHTML+=`
      <tr><td>${e.desc}</td><td class="text-red-400">৳ ${e.amount}</td></tr>`;
  });
});

/* Members */
db.collection("members").onSnapshot(s=>{
  memberGrid.innerHTML="";
  s.forEach(doc=>{
    let m=doc.data();
    memberGrid.innerHTML+=`
      <div class="glass p-4">
        <h4 class="font-black">${m.name}</h4>
        <p>${m.phone}</p>
      </div>`;
  });
});

/* Payment Numbers */
db.collection("config").doc("payment_numbers").onSnapshot(d=>{
  if(d.exists){
    bkash.value=d.data().bkash||"";
    nagad.value=d.data().nagad||"";
    rocket.value=d.data().rocket||"";
  }
});

/* Chart */
db.collection("payments").where("status","==","confirmed").onSnapshot(s=>{
  let sum={};
  s.forEach(d=>{
    let dt=d.data().timestamp?.toDate();
    if(!dt) return;
    let k=(dt.getMonth()+1)+"/"+dt.getFullYear();
    sum[k]=(sum[k]||0)+d.data().amount;
  });
  let labels=Object.keys(sum), data=Object.values(sum);
  if(chart) chart.destroy();
  chart=new Chart(fundChart,{
    type:"bar",
    data:{labels,datasets:[{label:"Monthly Collection",data,backgroundColor:"#10b981"}]}
  });
});
}

/* ================= ACTIONS ================= */
function approve(id,amt){
  db.collection("payments").doc(id).update({status:"confirmed"});
  db.collection("stats").doc("summary")
    .update({fund:firebase.firestore.FieldValue.increment(amt)});
  toast("Approved");
}

expForm.onsubmit=e=>{
  e.preventDefault();
  db.collection("expenses").add({
    desc:eDesc.value,
    amount:+eAmt.value,
    timestamp:firebase.firestore.FieldValue.serverTimestamp()
  });
  toast("Expense Added");
  e.target.reset();
}

function saveNumbers(){
  db.collection("config").doc("payment_numbers").set({
    bkash:bkash.value,
    nagad:nagad.value,
    rocket:rocket.value
  },{merge:true});
  toast("Payment numbers saved");
}

function logout(){auth.signOut();}
</script>

<!--
================= FIRESTORE SECURITY RULES (PASTE IN CONSOLE) =================

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isAdmin(){
      return request.auth != null &&
      get(/databases/$(database)/documents/members/
      $(request.auth.token.email.split('@')[0])).data.role == "admin";
    }

    match /members/{id}{
      allow read: if isAdmin();
      allow write: if false;
    }

    match /payments/{id}{
      allow create: if request.auth != null;
      allow read, update: if isAdmin();
    }

    match /expenses/{id}{
      allow read, write: if isAdmin();
    }

    match /stats/{id}{
      allow read, write: if isAdmin();
    }

    match /config/{id}{
      allow read, write: if isAdmin();
    }
  }
}
===============================================================================
-->

</body>
</html>
