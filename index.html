<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BSKF - কুপ্তলা আলোকিত সমাজ ফাউন্ডেশন</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background: #f0f4f8; }
        .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .premium-card { background: white; border-radius: 2.5rem; box-shadow: 0 20px 40px rgba(0,0,0,0.05); }
        .section-hide { display: none; }
        .btn-green { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        
        /* Certificate Design Inspired by Image */
        #certificateTemplate {
            width: 800px; padding: 40px; background: white; position: fixed; left: -9999px;
            border: 1px solid #ddd; font-family: 'Hind Siliguri', sans-serif;
        }
        .cert-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #10b981; padding-bottom: 10px; }
        .cert-title { text-align: center; flex-grow: 1; }
        .cert-body { margin-top: 20px; font-size: 14px; line-height: 1.8; text-align: justify; }
        .cert-footer { margin-top: 50px; display: flex; justify-content: space-between; text-align: center; }
        .sign-box { border-top: 1px solid #333; width: 150px; padding-top: 5px; font-size: 12px; font-weight: bold; }
        .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0.05; width: 400px; z-index: 0; }
        .cert-content { position: relative; z-index: 10; }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 glass-nav px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-2 cursor-pointer" onclick="showSection('home')">
            <div class="bg-green-600 p-2 rounded-xl shadow-lg"><i data-lucide="shield-check" class="text-white w-5 h-5"></i></div>
            <span class="text-xl font-black italic tracking-tighter">BSKF.</span>
        </div>
        <div class="relative">
            <button id="profileBtn" class="bg-white border p-2 rounded-xl shadow-sm hover:border-green-500 transition">
                <i data-lucide="user" class="w-6 h-6 text-slate-600"></i>
            </button>
            <div id="profileMenu" class="hidden absolute right-0 mt-3 w-56 bg-white rounded-2xl shadow-2xl border p-2 z-50 overflow-hidden">
                <div id="guestLinks" class="space-y-1">
                    <button onclick="showSection('login')" class="w-full text-left px-5 py-3 hover:bg-slate-50 rounded-xl font-bold text-sm">লগইন</button>
                    <button onclick="showSection('register')" class="w-full text-left px-5 py-3 hover:bg-green-50 rounded-xl font-bold text-sm text-green-600">নিবন্ধন</button>
                </div>
                <div id="userLinks" class="hidden space-y-1">
                    <button onclick="showSection('dashboard')" class="w-full text-left px-5 py-3 hover:bg-slate-50 rounded-xl font-bold text-sm">ড্যাশবোর্ড</button>
                    <button onclick="logout()" class="w-full text-left px-5 py-3 hover:bg-red-50 text-red-600 rounded-xl font-bold text-sm mt-1 border-t pt-4">লগআউট</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto p-6 space-y-10">
        
        <!-- Home Section -->
        <section id="home">
            <header class="text-center py-10 space-y-4">
                <h1 class="text-4xl md:text-6xl font-black tracking-tighter text-slate-900 uppercase italic">BSKF <span class="text-green-600">Foundation</span></h1>
                <p class="text-slate-500 font-bold italic">কুপ্তলা আলোকিত সমাজ গঠনে আমাদের ঐকান্তিক পথচলা।</p>
            </header>
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="premium-card p-8 border-t-4 border-green-500"><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">মোট ফান্ড</p><h3 id="statFund" class="text-3xl font-black">৳ ০</h3></div>
                <div class="premium-card p-8 border-t-4 border-red-500"><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">মোট ব্যয়</p><h3 id="statExpense" class="text-3xl font-black">৳ ০</h3></div>
                <div class="premium-card p-8 border-t-4 border-blue-500"><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">সদস্যবৃন্দ</p><h3 id="statMembers" class="text-3xl font-black">০ জন</h3></div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard" class="section-hide space-y-8">
            <div id="pendingStatus" class="hidden bg-yellow-50 border-2 border-dashed border-yellow-200 p-10 rounded-[3rem] text-center">
                <i data-lucide="clock" class="w-12 h-12 text-yellow-500 mx-auto mb-4"></i>
                <h3 class="text-xl font-black text-yellow-700 italic">আপনার আবেদনটি অপেক্ষমান!</h3>
                <p class="text-xs font-bold text-slate-500 mt-2 italic">এডমিন আপনার পেমেন্ট ২০০ টাকা যাচাই করার পর আইডি সক্রিয় হবে।</p>
            </div>

            <div id="activeDashboard" class="hidden space-y-8">
                <div class="premium-card p-10 text-center relative border-t-4 border-green-500">
                    <div class="bg-green-500 text-white absolute top-6 right-6 px-4 py-1 rounded-full text-[10px] font-bold italic">ACTIVE MEMBER</div>
                    <h4 id="dashName" class="text-3xl font-black text-slate-900 mb-1 uppercase italic">...</h4>
                    <p id="dashID" class="text-[10px] text-slate-400 font-black tracking-widest mb-8 italic">ID: BSKF-0000</p>
                    
                    <button onclick="downloadCertificate()" class="bg-slate-900 text-white px-8 py-3 rounded-xl font-black text-[10px] uppercase tracking-widest flex items-center gap-2 mx-auto shadow-xl transition hover:scale-105 active:scale-95">
                        <i data-lucide="download" class="w-4 h-4"></i> Download Membership Certificate
                    </button>
                </div>
            </div>
        </section>

        <!-- Hidden Certificate Template (Based on Image) -->
        <div id="certificateTemplate" class="relative">
            <img src="https://i.ibb.co/L8p5x9b/bskf-logo.png" class="watermark"> <!-- Watermark Logo -->
            <div class="cert-content">
                <div class="cert-header">
                    <img src="https://i.ibb.co/L8p5x9b/bskf-logo.png" width="80" alt="Logo">
                    <div class="cert-title">
                        <h2 style="font-size: 24px; font-weight: 900; margin: 0;">(কুপ্তলা আলোকিত সমাজ ফাউন্ডেশন)</h2>
                        <p style="font-size: 14px; font-weight: bold; margin: 5px 0;">স্থাপিত-২০২৬ইং</p>
                    </div>
                    <div style="width: 80px; height: 100px; border: 1px solid #333; display: flex; align-items: center; justify-content: center; font-size: 12px;">ছবি</div>
                </div>

                <p style="font-weight: bold; font-size: 14px;">সদস্য নং- <span id="certIDText">BSKF-0000</span></p>

                <div class="cert-body">
                    <h4 style="font-weight: 900; text-decoration: underline; margin-bottom: 10px;">সংগঠনের নীতিমালা এবং সদস্যপদ গ্রহণের ফর্ম:</h4>
                    <p>১। এটি একটি সেবামূলক সংগঠন। সংগঠনের অর্থ শুধুমাত্র গরিব ও অসহায়দের সাহায্য সহযোগিতার জন্য ব্যয় হবে।</p>
                    <p>২। সংগঠনের সকল কার্যক্রম সদস্যদের নিজস্ব অর্থে পরিচালিত হবে।</p>
                    <p>৪। এই সংগঠনের কোনো সদস্য সংগঠনের ভিতর কোনো ধরনের রাজনৈতিক প্রভাব দেখাতে পারবে না। যদি কোনো সদস্যের ব্যক্তিগত রাজনৈতিক কারণে সংগঠনের ওপর কোনো প্রভাব পড়ে, তবে তার সদস্যপদ বাতিল করা হবে।</p>
                    <p>৫। এই সংগঠনের কোন সদস্য কোন প্রকার একক সিদ্ধান্ত নিতে পারবে না। কোন সিদ্ধান্ত নেওয়ার থাকলে সকল সদস্যগণের সাথে আলোচনা করে সিদ্ধান্ত নিতে হবে।</p>
                    <p>৭। সদস্য ভর্তির ক্ষেত্রে সংগঠনের সকল নিয়ম কানুন মানতে হবে। একইভাবে টানা তিন মাসের টাকা পরিশোধ না করলে সদস্যপদ বাতিল বলে গণ্য হবে।</p>
                    
                    <div style="margin-top: 30px; border-top: 1px dashed #333; padding-top: 20px;">
                        <p>আমি <b><span id="certNameText">মেম্বারের নাম</span></b>, পিতা: <b><span id="certFather">...</span></b>, মাতা: <b><span id="certMother">...</span></b>, গ্রাম: <b><span id="certVillage">...</span></b>, থানা: <b><span id="certThana">...</span></b>, জেলা: <b><span id="certDist">...</span></b>, মোবাইল নং: <b><span id="certPhone">...</span></b> এই মর্মে অঙ্গীকার করতেছি যে উক্ত সংগঠনের সকল নিয়ম কানুন মেনে চলবো এবং সংগঠনের শৃঙ্খলা বিরোধী কোন প্রকার কাজ করবো না।</p>
                    </div>
                </div>

                <div class="cert-footer">
                    <div class="sign-box">সাধারণ সম্পাদক</div>
                    <div class="sign-box">ক্যাশিয়ার</div>
                    <div class="sign-box">সভাপতি</div>
                </div>
            </div>
        </div>

        <!-- Login / Register / Other sections (Keeping same logic) -->
        <section id="login" class="section-hide max-w-sm mx-auto py-10">
            <div class="premium-card p-10 border-t-4 border-slate-900">
                <h2 class="text-2xl font-black mb-8 text-center italic">সদস্য লগইন</h2>
                <form id="loginForm" class="space-y-4">
                    <input type="text" id="logPhone" placeholder="মোবাইল নম্বর" class="w-full p-4 bg-slate-50 rounded-xl border font-bold" required>
                    <input type="password" id="logPass" placeholder="পাসওয়ার্ড" class="w-full p-4 bg-slate-50 rounded-xl border font-bold" required>
                    <button type="submit" class="w-full bg-slate-900 text-white py-4 rounded-xl font-black italic">LOGIN →</button>
                </form>
            </div>
        </section>

    </main>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyDeFrZUu2ZwWzFa7owaC0v6WO_zP2lEJ1Q",
          authDomain: "firstdevloping.firebaseapp.com",
          projectId: "firstdevloping",
          storageBucket: "firstdevloping.firebasestorage.app",
          messagingSenderId: "197486624624",
          appId: "1:197486624624:web:2b7b055dc3ecbad20399b5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        lucide.createIcons();

        let activeUser = null;

        function showSection(id) {
            ['home', 'login', 'dashboard'].forEach(s => {
                const el = document.getElementById(s); if(el) el.classList.add('section-hide');
            });
            document.getElementById(id).classList.remove('section-hide');
            document.getElementById('profileMenu').classList.add('hidden');
        }

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                const phone = user.email.split('@')[0];
                db.collection("members").doc(phone).onSnapshot(doc => {
                    if(doc.exists) {
                        activeUser = doc.data();
                        updateDashboardUI();
                    }
                });
            } else { showSection('home'); }
        });

        function updateDashboardUI() {
            document.getElementById('dashName').innerText = activeUser.name;
            document.getElementById('dashID').innerText = 'ID: BSKF-' + activeUser.id;
            
            // Mapping for Certificate Template
            document.getElementById('certNameText').innerText = activeUser.name;
            document.getElementById('certIDText').innerText = 'BSKF-' + activeUser.id;
            document.getElementById('certFather').innerText = activeUser.father || '...';
            document.getElementById('certMother').innerText = activeUser.mother || '...';
            document.getElementById('certVillage').innerText = activeUser.village || '...';
            document.getElementById('certThana').innerText = activeUser.thana || '...';
            document.getElementById('certDist').innerText = activeUser.district || '...';
            document.getElementById('certPhone').innerText = activeUser.phone;

            document.getElementById('userLinks').classList.remove('hidden');
            document.getElementById('guestLinks').classList.add('hidden');

            if(activeUser.status === 'pending') {
                document.getElementById('pendingStatus').classList.remove('hidden');
                document.getElementById('activeDashboard').classList.add('hidden');
            } else {
                document.getElementById('pendingStatus').classList.add('hidden');
                document.getElementById('activeDashboard').classList.remove('hidden');
            }
        }

        function downloadCertificate() {
            const template = document.getElementById('certificateTemplate');
            html2canvas(template).then(canvas => {
                const link = document.createElement('a');
                link.download = `BSKF-Certificate-${activeUser.name}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // Login Script
        document.getElementById('loginForm').onsubmit = async (e) => {
            e.preventDefault();
            try {
                await auth.signInWithEmailAndPassword(document.getElementById('logPhone').value + "@bskf.com", document.getElementById('logPass').value);
                showSection('dashboard');
            } catch (err) { alert("ভুল পাসওয়ার্ড বা নম্বর।"); }
        };

        function logout() { auth.signOut(); location.reload(); }
    </script>
</body>
</html>
