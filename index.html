<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BSKF - কুপ্তলা আলোকিত সমাজ ফাউন্ডেশন</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background: #f8fafc; color: #1e293b; }
        .glass-nav { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid #e2e8f0; }
        .section-hide { display: none; }
        .premium-card { background: white; border-radius: 2rem; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        
        /* --- Official Member Form Style (From Image) --- */
        #certificateTemplate {
            width: 850px; height: 1150px; background: white; position: fixed; left: -9999px;
            padding: 60px; color: #000; overflow: hidden; border: 1px solid #ccc;
        }
        .cert-header { text-align: center; position: relative; margin-bottom: 30px; }
        .cert-logo { position: absolute; left: 0; top: 0; width: 110px; }
        .photo-box { position: absolute; right: 0; top: 0; width: 100px; height: 120px; border: 1px solid #000; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
        
        .bismillah { font-size: 16px; font-weight: bold; margin-bottom: 5px; }
        .org-name { font-size: 30px; font-weight: 900; }
        .est-date { font-size: 15px; font-weight: bold; margin-top: 5px; }

        .rules-header { background: #000; color: #fff; padding: 4px 15px; display: inline-block; font-weight: bold; margin: 20px 0 10px 0; }
        .rules-content { font-size: 15px; line-height: 1.8; text-align: justify; }
        .highlight-box { border: 1.5px solid #000; padding: 10px; margin: 10px 0; font-weight: 600; }

        .form-body { margin-top: 30px; font-size: 17px; line-height: 2.5; }
        .dotted-line { border-bottom: 1px dotted #000; display: inline-block; padding: 0 10px; font-weight: bold; color: #1e40af; min-width: 50px; text-align: center; }
        
        .signature-area { margin-top: 80px; display: flex; justify-content: space-between; text-align: center; }
        .sig-col { width: 180px; border-top: 1px solid #000; padding-top: 8px; font-size: 14px; font-weight: bold; position: relative; }
        .admin-sig { font-family: 'Dancing Script', cursive; position: absolute; top: -35px; left: 0; right: 0; font-size: 26px; color: #1e40af; }
        
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .animate-marquee { animation: marquee 30s linear infinite; }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 glass-nav px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-2 cursor-pointer" onclick="showSection('home')">
            <div class="bg-green-600 p-2 rounded-xl shadow-lg"><i data-lucide="shield-check" class="text-white w-5 h-5"></i></div>
            <span class="text-xl font-black italic tracking-tighter">BSKF.</span>
        </div>
        <div class="relative">
            <button id="profileBtn" class="bg-white border p-2 rounded-xl shadow-sm"><i data-lucide="user" class="w-6 h-6"></i></button>
            <div id="profileMenu" class="hidden absolute right-0 mt-3 w-56 bg-white rounded-2xl shadow-2xl border p-2 z-50">
                <div id="guestLinks" class="space-y-1">
                    <button onclick="showSection('login')" class="w-full text-left px-5 py-3 hover:bg-slate-50 rounded-xl font-bold">লগইন</button>
                    <button onclick="showSection('register')" class="w-full text-left px-5 py-3 hover:bg-slate-50 rounded-xl font-bold">নিবন্ধন</button>
                </div>
                <div id="userLinks" class="hidden space-y-1">
                    <button onclick="showSection('dashboard')" class="w-full text-left px-5 py-3 hover:bg-slate-50 rounded-xl font-bold">ড্যাশবোর্ড</button>
                    <button onclick="logout()" class="w-full text-left px-5 py-3 text-red-600 font-bold border-t mt-1">লগআউট</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto p-4 space-y-8">
        
        <!-- Home Section -->
        <section id="home">
            <div class="text-center py-10 space-y-2">
                <h1 class="text-5xl font-black text-slate-800 uppercase italic">BSKF <span class="text-green-600">Foundation</span></h1>
                <p class="text-slate-500 font-bold">কুপ্তলা আলোকিত সমাজ ফাউন্ডেশন</p>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                <div class="bg-white p-6 rounded-3xl shadow-sm border-t-4 border-green-500 text-center">
                    <p class="text-[10px] uppercase font-bold text-slate-400">মোট ফান্ড</p>
                    <h3 id="statFund" class="text-2xl font-black">৳ ০</h3>
                </div>
                <div class="bg-white p-6 rounded-3xl shadow-sm border-t-4 border-red-500 text-center">
                    <p class="text-[10px] uppercase font-bold text-slate-400">মোট ব্যয়</p>
                    <h3 id="statExpense" class="text-2xl font-black">৳ ০</h3>
                </div>
                <div class="hidden md:block bg-white p-6 rounded-3xl shadow-sm border-t-4 border-blue-500 text-center">
                    <p class="text-[10px] uppercase font-bold text-slate-400">সদস্যবৃন্দ</p>
                    <h3 id="statMembers" class="text-2xl font-black">০ জন</h3>
                </div>
            </div>

            <div class="bg-slate-900 text-white py-3 rounded-2xl overflow-hidden mb-10">
                <div id="ticker" class="flex gap-20 animate-marquee whitespace-nowrap text-xs font-bold italic uppercase tracking-widest"></div>
            </div>

            <div class="bg-white p-8 rounded-3xl shadow-sm border overflow-hidden">
                <h4 class="font-black mb-4 flex items-center gap-2 italic"><i data-lucide="list"></i> সাম্প্রতিক ব্যয়সমূহ</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left"><tbody id="homeExpList" class="divide-y"></tbody></table>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard" class="section-hide space-y-6">
            <div id="activeDashboard" class="hidden">
                <div class="premium-card p-10 text-center border-t-8 border-green-600">
                    <div class="bg-green-100 text-green-700 px-4 py-1 rounded-full text-[10px] font-black uppercase inline-block mb-4">Official Verified Member</div>
                    <h2 id="dashName" class="text-4xl font-black">...</h2>
                    <p id="dashID" class="text-slate-400 font-bold tracking-widest mt-1">ID: BSKF-0000</p>
                    
                    <button onclick="downloadCertificate()" class="mt-8 bg-slate-900 text-white px-10 py-5 rounded-2xl font-black text-sm flex items-center gap-2 mx-auto hover:scale-105 transition shadow-xl">
                        <i data-lucide="download" class="w-5 h-5"></i> ডিজিটাল সদস্যপত্র ডাউনলোড করুন
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-6">
                    <button onclick="showSection('payment')" class="bg-green-600 text-white p-6 rounded-3xl font-black italic shadow-lg">চাঁদা জমা দিন</button>
                    <button onclick="showSection('history')" class="bg-white border p-6 rounded-3xl font-black italic shadow-sm">পেমেন্ট ইতিহাস</button>
                </div>
            </div>

            <div id="pendingStatus" class="hidden text-center py-20 bg-yellow-50 rounded-3xl border-2 border-dashed border-yellow-200">
                <i data-lucide="clock" class="w-12 h-12 text-yellow-500 mx-auto mb-4"></i>
                <h3 class="text-xl font-black text-yellow-700">আপনার সদস্যপদ যাচাই করা হচ্ছে</h3>
                <p class="text-sm font-bold text-slate-500 mt-2">এডমিন আপনার পেমেন্ট চেক করার পর প্রোফাইল সক্রিয় হবে।</p>
            </div>
        </section>

        <!-- --- OFFICIAL FORM TEMPLATE (ছবি অনুযায়ী হুবহু) --- -->
        <div id="certificateTemplate">
            <!-- Background Watermark -->
            <img src="https://i.ibb.co/Lhq99F5/bskf-logo.png" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 450px; opacity: 0.08;">

            <div class="cert-header">
                <img src="https://i.ibb.co/Lhq99F5/bskf-logo.png" class="cert-logo">
                <div class="bismillah">বিসমিল্লাহির রাহমানির রাহিম</div>
                <div class="org-name">(কুপ্তলা আলোকিত সমাজ ফাউন্ডেশন)</div>
                <div class="est-date">স্থাপিত-২০২৩ইং</div>
                <div class="photo-box">ছবি</div>
            </div>

            <div style="font-weight: bold; font-size: 16px; margin-bottom: 10px;">
                সদস্য নং- <span id="certID" class="dotted-line" style="min-width: 150px;">BSKF-0000</span>
            </div>

            <div class="rules-header">সংগঠনের নীতিমালা এবং সদস্যপদ গ্রহণের ফর্ম :</div>

            <div class="rules-content">
                <p>১। এটি একটি সেবামূলক সংগঠন। সংগঠনের অর্থ শুধুমাত্র গরিব ও অসহায়দের সাহায্য সহযোগিতার জন্য ব্যয় হবে।</p>
                <p>২। সংগঠনের সকল কার্যক্রম সদস্যদের নিজস্ব অর্থে পরিচালিত হবে।</p>
                
                <div class="highlight-box">
                    <p>৪। এই সংগঠনের কোনো সদস্যগণ সংগঠনের ভিতর কোন ধরনের রাজনৈতিক প্রভাব দেখাতে পারবে না। যদি কোনো সদস্যের ব্যক্তিগত রাজনৈতিক কারণে সংগঠনের উপর কোনো প্রভাব পড়ে, তবে তার সদস্যপদ বাতিল করা হবে।</p>
                    <p>৫। এই সংগঠনের কোন সদস্য কোন প্রকার একক সিদ্ধান্ত নিতে পারবে না। কোন সিদ্ধান্ত নেওয়ার থাকলে সকল সদস্যগণের সাথে আলোচনা করে সিদ্ধান্ত নিতে হবে। কোন সদস্য ভুল কিছু উপস্থাপন করলে অন্যরা ভদ্রতার সাথে কথা বলে তাকে বোঝাবেন।</p>
                </div>

                <p>৬। সংগঠনের সকল তথ্য এবং হিসাব স্বচ্ছতার সাথে সদস্যদের জানানো হবে এবং প্রয়োজনে স্বাধীনভাবে প্রকাশ করতে পারবে।</p>
                <p>৭। সদস্য ভর্তির ক্ষেত্রে সংগঠনের সকল নিয়ম কানুন মানতে হবে। একইভাবে টানা তিন মাসের টাকা পরিশোধ না করলে সদস্যপদ বাতিল বলে গণ্য হবে।</p>
            </div>

            <div class="form-body">
                আমি <span id="certName" class="dotted-line" style="min-width: 300px;">সদস্যের নাম</span> 
                পিতা/স্বামী <span class="dotted-line" style="min-width: 250px;">..........................................</span> 
                মাতা <span class="dotted-line" style="min-width: 200px;">..........................................</span> <br>
                গ্রাম <span class="dotted-line" style="min-width: 180px;">..........................</span> 
                ইউপি <span class="dotted-line" style="min-width: 180px;">..........................</span> 
                থানা <span class="dotted-line" style="min-width: 150px;">..........................</span> 
                জেলা <span class="dotted-line" style="min-width: 150px;">..........................</span> <br>
                মোবাইল নং- <span id="certPhone" class="dotted-line" style="min-width: 250px;">017XXXXXXXXX</span> 
                এই মর্মে অঙ্গীকার করতেছি যে উক্ত সংগঠনের সকল নিয়ম কানুন মেনে চলবো এবং সংগঠনের শৃঙ্খলা বিরোধী কোন প্রকার কাজ করবো না।
            </div>

            <div style="text-align: right; margin-top: 50px;">
                <p style="font-weight: bold; margin-bottom: 40px; margin-right: 20px;">সদস্যের স্বাক্ষর ও তারিখ</p>
            </div>

            <div class="signature-area">
                <div class="sig-col">
                    <span class="admin-sig">Alfaz</span>
                    সাধারণ সম্পাদক
                </div>
                <div class="sig-col">ক্যাশিয়ার</div>
                <div class="sig-col">সভাপতি</div>
            </div>
        </div>

        <!-- Hidden Sections: Register, Payment, History, Login (Keep Existing) -->
        <section id="register" class="section-hide max-w-xl mx-auto">
            <div class="premium-card p-8 border-t-8 border-green-600">
                <h2 class="text-2xl font-black mb-6 text-center italic">নতুন সদস্য নিবন্ধন</h2>
                <form id="regForm" class="space-y-4">
                    <input type="text" id="regName" placeholder="পুরো নাম" class="w-full p-4 bg-slate-50 rounded-xl border font-bold" required>
                    <input type="text" id="regPhone" placeholder="মোবাইল নম্বর" class="w-full p-4 bg-slate-50 rounded-xl border font-bold" required>
                    <input type="text" id="regNID" placeholder="এনআইডি নম্বর" class="w-full p-4 bg-slate-50 rounded-xl border font-bold" required>
                    <input type="password" id="regPass" placeholder="পাসওয়ার্ড তৈরি করুন" class="w-full p-4 bg-slate-50 rounded-xl border font-bold" required>
                    <div class="bg-green-50 p-4 rounded-xl border-2 border-dashed border-green-200 text-center">
                        <p class="text-xs font-black text-green-700 mb-2">নিবন্ধন ফি ২০০ টাকা নিচের নম্বরে পাঠিয়ে TrxID দিন</p>
                        <p id="regNumbers" class="text-[10px] font-bold text-slate-600 uppercase"></p>
                        <input type="text" id="regTrx" placeholder="Transaction ID (TrxID)" class="w-full p-3 mt-3 bg-white rounded-lg border-2 border-green-300 font-black text-center" required>
                    </div>
                    <button type="submit" class="w-full bg-green-600 text-white py-4 rounded-xl font-black text-lg">নিবন্ধন সম্পন্ন করুন</button>
                </form>
            </div>
        </section>

        <section id="login" class="section-hide max-w-sm mx-auto py-10">
            <div class="premium-card p-8 border-t-8 border-slate-900 text-center">
                <h2 class="text-2xl font-black mb-6 uppercase">Member Login</h2>
                <form id="loginForm" class="space-y-4">
                    <input type="text" id="logPhone" placeholder="মোবাইল নম্বর" class="w-full p-4 bg-slate-50 rounded-xl border font-bold" required>
                    <input type="password" id="logPass" placeholder="পাসওয়ার্ড" class="w-full p-4 bg-slate-50 rounded-xl border font-bold" required>
                    <button type="submit" class="w-full bg-slate-900 text-white py-4 rounded-xl font-black">লগইন করুন</button>
                </form>
            </div>
        </section>

        <section id="payment" class="section-hide max-w-md mx-auto">
            <div class="premium-card p-8 border-t-8 border-green-600">
                <h3 class="text-xl font-black mb-6 italic">চাঁদা প্রদান ফরম</h3>
                <form id="payForm" class="space-y-4">
                    <select id="pMethod" class="w-full p-4 bg-slate-50 rounded-xl border font-bold" required>
                        <option value="">মেথড সিলেক্ট করুন</option><option value="Bkash">Bkash</option><option value="Nagad">Nagad</option>
                    </select>
                    <input type="number" id="pAmt" placeholder="পরিমাণ (৳)" class="w-full p-4 bg-slate-50 rounded-xl border font-bold" required>
                    <input type="text" id="pTrx" placeholder="TrxID" class="w-full p-4 bg-slate-50 rounded-xl border font-black" required>
                    <button type="submit" class="w-full bg-green-600 text-white py-4 rounded-xl font-black">পেমেন্ট নিশ্চিত করুন</button>
                </form>
            </div>
        </section>

        <section id="history" class="section-hide max-w-md mx-auto space-y-4 pb-20">
            <h3 class="text-xl font-black italic">আপনার পেমেন্ট রেকর্ড</h3>
            <div id="histList" class="space-y-3"></div>
        </section>

    </main>

    <script>
        // Firebase Configuration (Same as your project)
        const firebaseConfig = {
          apiKey: "AIzaSyDeFrZUu2ZwWzFa7owaC0v6WO_zP2lEJ1Q",
          authDomain: "firstdevloping.firebaseapp.com",
          projectId: "firstdevloping",
          storageBucket: "firstdevloping.firebasestorage.app",
          messagingSenderId: "197486624624",
          appId: "1:197486624624:web:2b7b055dc3ecbad20399b5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        lucide.createIcons();

        let activeUser = null;

        function showSection(id) {
            ['home', 'dashboard', 'login', 'register', 'payment', 'history'].forEach(s => {
                const el = document.getElementById(s); if(el) el.classList.add('section-hide');
            });
            document.getElementById(id).classList.remove('section-hide');
            document.getElementById('profileMenu').classList.add('hidden');
            window.scrollTo(0,0);
        }

        document.getElementById('profileBtn').onclick = (e) => { e.stopPropagation(); document.getElementById('profileMenu').classList.toggle('hidden'); }
        document.body.onclick = () => document.getElementById('profileMenu').classList.add('hidden');

        // Auth Logic
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                const phone = user.email.split('@')[0];
                db.collection("members").doc(phone).onSnapshot(doc => {
                    if(doc.exists) {
                        activeUser = doc.data();
                        updateDashboardUI();
                    }
                });
            } else {
                showSection('home');
            }
        });

        function updateDashboardUI() {
            document.getElementById('dashName').innerText = activeUser.name;
            document.getElementById('dashID').innerText = 'ID: BSKF-' + activeUser.id;
            
            // Sync with Template
            document.getElementById('certName').innerText = activeUser.name;
            document.getElementById('certID').innerText = 'BSKF-' + activeUser.id;
            document.getElementById('certPhone').innerText = activeUser.phone;

            document.getElementById('guestLinks').classList.add('hidden');
            document.getElementById('userLinks').classList.remove('hidden');

            if(activeUser.status === 'pending') {
                document.getElementById('pendingStatus').classList.remove('hidden');
                document.getElementById('activeDashboard').classList.add('hidden');
            } else {
                document.getElementById('pendingStatus').classList.add('hidden');
                document.getElementById('activeDashboard').classList.remove('hidden');
                loadHistory(activeUser.phone);
            }
        }

        // Action: Download
        function downloadCertificate() {
            const template = document.getElementById('certificateTemplate');
            html2canvas(template, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `BSKF_Form_${activeUser.name}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            });
        }

        // Initialize Stats
        function initApp() {
            db.collection("stats").doc("summary").onSnapshot(doc => {
                if(doc.exists) {
                    const d = doc.data();
                    document.getElementById('statFund').innerText = '৳ ' + (d.fund || 0).toLocaleString('bn-BD');
                    document.getElementById('statExpense').innerText = '৳ ' + (d.expenses || 0).toLocaleString('bn-BD');
                }
            });

            db.collection("members").where("status", "==", "active").onSnapshot(snap => {
                document.getElementById('statMembers').innerText = snap.size + ' জন';
                const ticker = document.getElementById('ticker'); ticker.innerHTML = "";
                snap.forEach(m => ticker.innerHTML += `<span>★ ${m.data().name} (${m.data().role})</span>`);
            });

            db.collection("expenses").onSnapshot(snap => {
                const list = document.getElementById('homeExpList'); list.innerHTML = "";
                let docs = []; snap.forEach(doc => docs.push(doc.data()));
                docs.sort((a,b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0)).slice(0, 5).forEach(e => {
                    list.innerHTML += `<tr><td class="py-3 font-bold">${e.desc}</td><td class="py-3 text-red-500 font-black">৳ ${e.amount}</td></tr>`;
                });
            });

            db.collection("config").doc("payment_numbers").onSnapshot(doc => {
                if(doc.exists) {
                    const d = doc.data();
                    document.getElementById('regNumbers').innerText = `Bkash: ${d.bkash} | Nagad: ${d.nagad}`;
                }
            });
        }

        // Form Submissions
        document.getElementById('regForm').onsubmit = async (e) => {
            e.preventDefault();
            const phone = document.getElementById('regPhone').value;
            try {
                await auth.createUserWithEmailAndPassword(phone + "@bskf.com", document.getElementById('regPass').value);
                const info = { name: document.getElementById('regName').value, phone, nid: document.getElementById('regNID').value, id: Math.floor(1000 + Math.random() * 9000), status: 'pending', role: 'সদস্য' };
                await db.collection("members").doc(phone).set(info);
                await db.collection("payments").add({ phone, amount: 200, trxId: document.getElementById('regTrx').value, status: 'pending', type: 'registration', timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                alert("আবেদন সফল হয়েছে!"); showSection('dashboard');
            } catch (err) { alert(err.message); }
        };

        document.getElementById('loginForm').onsubmit = async (e) => {
            e.preventDefault();
            try { await auth.signInWithEmailAndPassword(document.getElementById('logPhone').value + "@bskf.com", document.getElementById('logPass').value); showSection('dashboard'); }
            catch (err) { alert("ভুল তথ্য।"); }
        };

        document.getElementById('payForm').onsubmit = async (e) => {
            e.preventDefault();
            await db.collection("payments").add({ phone: activeUser.phone, amount: parseFloat(document.getElementById('pAmt').value), trxId: document.getElementById('pTrx').value, status: 'pending', type: 'monthly', timestamp: firebase.firestore.FieldValue.serverTimestamp() });
            alert("পেমেন্ট জমা হয়েছে!"); showSection('history');
        };

        function loadHistory(phone) {
            db.collection("payments").where("phone", "==", phone).onSnapshot(snap => {
                const list = document.getElementById('histList'); list.innerHTML = "";
                snap.forEach(p => {
                    const d = p.data();
                    list.innerHTML += `<div class="bg-white p-4 rounded-2xl border flex justify-between items-center"><div><p class="font-black">৳ ${d.amount}</p><p class="text-[10px] text-slate-400">${d.trxId}</p></div><span class="text-[10px] font-bold uppercase ${d.status === 'confirmed' ? 'text-green-600' : 'text-yellow-600'}">${d.status}</span></div>`;
                });
            });
        }

        function logout() { auth.signOut(); location.reload(); }
        initApp();
    </script>
</body>
</html>
